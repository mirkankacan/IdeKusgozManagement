@{
    ViewData["Title"] = "Takvim";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section CalendarCss {
    <link href="~/theme/assets/plugins/fullcalendar/main.min.css" rel="stylesheet">
}
@section Styles {

}

<div class="card">
    <div class="card-body">
        <div id='calendar'></div>
    </div>
</div>


@section Scripts {
    <script src="~/theme/assets/plugins/fullcalendar/main.min.js"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'tr',
                firstDay: 1,
                  events: function(fetchInfo, successCallback, failureCallback) {
                    fetch('/takvim/izinler')
                        .then(response => response.json())
                        .then(data => {
                            if (data.isSuccess && data.data) {
                                const events = data.data.map(leave => ({
                                    id: leave.id,
                                    title: leave.createdByName + ' - ' + leave.reason,
                                    start: leave.startDate,
                                    end: new Date(new Date(leave.endDate).getTime() + 24 * 60 * 60 * 1000),
                                    className: 'leave-status-' + leave.status
                                }));
                                successCallback(events);
                            } else {
                                console.error('API hatasý:', data.message);
                                failureCallback();
                            }
                        })
                        .catch(error => {
                            console.error('Veri yükleme hatasý:', error);
                            failureCallback();
                        });
                }
            });
            calendar.render();
        });

    </script>
}